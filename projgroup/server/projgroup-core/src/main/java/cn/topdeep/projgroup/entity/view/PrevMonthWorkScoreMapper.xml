<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.topdeep.projgroup.entity.view.PrevMonthWorkScoreMapper">
  <resultMap id="BaseResultMap" type="cn.topdeep.projgroup.entity.view.PrevMonthWorkScore">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <constructor>
      <arg column="REAL_NAME" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="WORK_USER_ID" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="WORK_DAY_COUNT" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="WORK_DAY_SCORE" javaType="java.lang.Double" jdbcType="DECIMAL" />
    </constructor>
  </resultMap>
  <select id="selectObjects" resultMap="BaseResultMap">
SELECT 
    t2.REAL_NAME,
    T1.WORK_USER_ID,
    T1.WORK_DAY_COUNT,
    CASE
        WHEN T1.work_day_score IS NULL THEN 0
        ELSE WORK_DAY_SCORE
    END AS WORK_DAY_SCORE
FROM
    (SELECT 
        WORK_USER_ID,
            COUNT(*) AS WORK_DAY_COUNT,
            0 AS WORK_DAY_SCORE
    FROM
        (SELECT 
        WORK_USER_ID,
            WORK_DAY,
            MIN(WORK_EVALUATION_SCORE) AS WORK_EVALUATION_SCORE
    FROM
        T_WORK_LOG
    GROUP BY WORK_USER_ID , WORK_DAY) AS t_pre
    WHERE
        (YEAR(WORK_DAY) = YEAR(DATE_ADD(CURDATE(),INTERVAL -1 MONTH)))
            AND (MONTH(WORK_DAY) = MONTH(DATE_ADD(CURDATE(), INTERVAL -1 MONTH)))
    GROUP BY WORK_USER_ID) AS T1
        INNER JOIN
    T_USER AS t2 ON t2.USER_ID = T1.WORK_USER_ID
  </select>
</mapper>